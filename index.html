<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimativa das jornadas de trabalho da mulher do s√©culo XXI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        /* Base e Layout Responsivo */
        body { font-family: Arial, sans-serif; background-color: #f4f7f6; color: #333; margin: 10px; font-size: 16px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: relative; }
        
        h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; font-size: 1.8rem; }
        .section { margin-bottom: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        
        label { display: block; margin: 15px 0 5px; font-weight: bold; font-size: 1.1rem; }
        select, button, input[type="date"] { width: 100%; padding: 14px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; font-size: 1.1rem; box-sizing: border-box; }
        
        button { background-color: #3498db; color: white; border: none; cursor: pointer; font-weight: bold; margin-top: 20px; }
        button:hover { background-color: #2980b9; }
        
        /* Resultados e Gr√°ficos */
        #areaResultados { display: none; margin-top: 30px; border-top: 2px dashed #ccc; padding-top: 20px; }
        
        /* Filtros de Resultado */
        .filter-section { background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #eee; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: #ecf0f1; padding: 20px; text-align: center; border-radius: 4px; border-left: 5px solid #3498db; font-size: 1.1rem; }
        .stat-card strong { font-size: 1.5rem; }
        
        .charts-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-top: 25px; }
        .chart-box { background: #fff; padding: 15px; border: 1px solid #ddd; border-radius: 5px; min-height: 400px; }

        .table-container { overflow-x: auto; margin-top: 35px; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; font-size: 1rem; min-width: 800px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #3498db; color: white; }
        tfoot tr { background-color: #e8f4fd; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        
        /* Bot√µes Secretos */
        .dot-btn { 
            position: fixed; bottom: 15px; width: 12px; height: 12px; 
            border: none; border-radius: 50%; cursor: pointer; opacity: 0.4;
            transition: opacity 0.3s; z-index: 1000;
        }
        .dot-btn:hover { opacity: 1; }
        .clear-btn { right: 15px; background-color: #e74c3c; }
        .view-btn { left: 15px; background-color: #2ecc71; }

        .btn-print { background-color: #7f8c8d; margin-bottom: 25px; width: auto; padding: 10px 25px; }

        /* MODO COMPUTADOR AMPLIADO */
        @media (min-width: 992px) {
            body { font-size: 24px; padding: 40px; }
            .container { padding: 40px; max-width: 1400px; }
            h2 { font-size: 3rem; padding-bottom: 20px; }
            .section { padding: 40px; margin-bottom: 40px; }
            label { font-size: 1.6rem; margin: 25px 0 10px; }
            select, button, input[type="date"] { font-size: 1.5rem; padding: 22px; border-radius: 8px; }
            .stat-card { padding: 30px; font-size: 1.5rem; }
            .stat-card strong { font-size: 2.5rem; }
            .chart-box { padding: 30px; min-height: 500px; }
            table { font-size: 1.4rem; }
            th, td { padding: 20px; }
            h3 { font-size: 2rem; margin-top: 40px; }
        }

        @media (max-width: 600px) {
            h2 { font-size: 1.4rem; }
            .filter-section { grid-template-columns: 1fr; }
            .charts-container { grid-template-columns: 1fr; }
            .chart-box { min-height: 300px; }
        }

        @media print {
            body { background: white; margin: 0; padding: 0; font-size: 12pt; }
            .container { box-shadow: none; border: none; max-width: 100%; padding: 0; }
            .section, .dot-btn, .btn-print, .filter-section, p { display: none !important; }
            #areaResultados { display: block !important; margin-top: 0; border: none; }
            .chart-box { page-break-inside: avoid; border: none; min-height: auto; }
            table { min-width: 100%; font-size: 10pt; }
            h2 { font-size: 20pt; text-align: center; }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Pesquisa: Jornadas da Mulher do S√©culo XXI</h2>
    <p>Estimativa das jornadas de trabalho da mulher do s√©culo XXI.</p>

    <div class="section">
        <label>Selecione o Perfil do Entrevistado:</label>
        <select id="perfil" onchange="toggleFields()">
            <option value="">-- Selecione --</option>
            <option value="Esposa">Esposa</option>
            <option value="Autonoma">Mulher (Gest√£o exclusiva e aut√¥noma do lar)</option>
            <option value="Esposo">Esposo</option>
            <option value="Familiar">Familiar (Filho, Irm√£o, etc)</option>
        </select>

        <div id="detalhePerfil" style="display:none; margin-top:10px;">
            <label id="labelDetalhe">Tipo de Atividade:</label>
            <select id="valorDetalhe"></select>
        </div>

        <div id="camposComuns" style="display:none;">
            <div id="grupoAjuda">
                <label>Recebe ajuda nas tarefas dom√©sticas?</label>
                <select id="recebeAjuda">
                    <option value="">--</option>
                    <option value="Sim">Sim</option>
                    <option value="N√£o">N√£o</option>
                </select>
            </div>

            <label>Contribui ativamente nas tarefas dom√©sticas?</label>
            <select id="contribuiTarefa">
                <option value="">--</option>
                <option value="Sim">Sim</option>
                <option value="N√£o">N√£o</option>
            </select>
            
            <div id="grupoHoras">
                <label>Carga hor√°ria di√°ria total:</label>
                <select id="horasGeral">
                    <option value="">--</option>
                    <option value="At√© 8h">At√© 8h</option>
                    <option value="8h at√© 14h">8h at√© 14h</option>
                    <option value="Mais de 14h">Mais de 14h</option>
                </select>
            </div>
        </div>

        <button onclick="salvarPesquisa()">Salvar Respostas</button>
    </div>

    <div id="areaResultados">
        <button class="btn-print" onclick="window.print()">üñ®Ô∏è Imprimir Relat√≥rio</button>
        
        <div class="filter-section">
            <div>
                <label>Filtrar por Tipo de Atividade:</label>
                <select id="filtroAtividade" onchange="atualizarInterface()">
                    <option value="Todos">Todas as Atividades</option>
                    <option value="Trabalha fora e no lar">Trabalha fora e no lar</option>
                    <option value="Somente no lar">Somente no lar</option>
                    <option value="Gest√£o Aut√¥noma">Gest√£o Aut√¥noma</option>
                    <option value="C√¥njuge">C√¥njuge (Esposo)</option>
                    <option value="Familiar">Familiar</option>
                </select>
            </div>
            <div>
                <label>Ver Participa√ß√£o por Data:</label>
                <input type="date" id="filtroData" onchange="atualizarInterface()">
            </div>
        </div>

       <div class="stats-grid">
            <div class="stat-card">Esposas: <br><strong id="totalM">0</strong></div>
            <div class="stat-card">Aut√¥nomas: <br><strong id="totalA">0</strong></div>
            <div class="stat-card">Esposos: <br><strong id="totalH">0</strong></div>
            <div class="stat-card">Familiares: <br><strong id="totalF">0</strong></div>
        </div>

        <h3 id="tituloData">Participa√ß√£o em: --/--/----</h3>
        <div class="stats-grid" style="border: 2px solid #3498db; padding: 10px; border-radius: 8px; background: #f0f7ff;">
            <div class="stat-card" style="border-left-color: #e91e63;">Esposas (Data): <br><strong id="dataM">0</strong></div>
            <div class="stat-card" style="border-left-color: #2ecc71;">Aut√¥nomas (Data): <br><strong id="dataA">0</strong></div>
            <div class="stat-card" style="border-left-color: #2980b9;">Esposos (Data): <br><strong id="dataH">0</strong></div>
            <div class="stat-card" style="border-left-color: #9b59b6;">Familiares (Data): <br><strong id="dataF">0</strong></div>
        </div>

        <div class="charts-container">
            <div class="chart-box"><canvas id="barChart"></canvas></div>
            <div class="chart-box"><canvas id="pieChart"></canvas></div>
            <div class="chart-box"><canvas id="hoursChart"></canvas></div>
            <div class="chart-box"><canvas id="womenContribChart"></canvas></div>
            <div class="chart-box"><canvas id="menContribChart"></canvas></div>
            <div class="chart-box"><canvas id="famContribChart"></canvas></div>
        </div>

        <h3>Relat√≥rio Acumulado</h3>
        <div class="table-container">
            <table id="tabelaRelatorio">
                <thead>
                    <tr>
                        <th>Perfil</th>
                        <th>Ajuda (Sim)</th>
                        <th>Contribui (Sim)</th>
                        <th>At√© 8h</th>
                        <th>8h-14h</th>
                        <th>+14h</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela"></tbody>
                <tfoot id="rodapeTabela">
                    <tr>
                        <td colspan="6" style="text-align: right;">Participantes na data selecionada:</td>
                        <td id="totalDataCount">0</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <button class="dot-btn view-btn" onclick="toggleRelatorio()" title="Acesso aos Resultados"></button>
    <button class="dot-btn clear-btn" onclick="limparDados()" title="Limpar Banco"></button>
</div>

<script>
    // --- CONFIGURA√á√ÉO DO FIREBASE ---
    // Voc√™ deve substituir os valores abaixo pelos dados do seu console Firebase
    const firebaseConfig = {
        apiKey: "SUA_API_KEY",
        authDomain: "SEU_PROJETO.firebaseapp.com",
        databaseURL: "https://SEU_PROJETO-default-rtdb.firebaseio.com",
        projectId: "SEU_PROJETO",
        storageBucket: "SEU_PROJETO.appspot.com",
        messagingSenderId: "SEU_ID",
        appId: "SEU_APP_ID"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let db = []; 
    const SENHA_MESTRA = "210109"; 
    let charts = {};

    document.getElementById('filtroData').valueAsDate = new Date();

    // Sincroniza√ß√£o em Tempo Real: Sempre que o banco mudar, a interface atualiza para todos
    database.ref('pesquisas').on('value', (snapshot) => {
        const data = snapshot.val();
        db = data ? Object.values(data) : [];
        atualizarInterface();
    });

    function toggleFields() {
        const perfil = document.getElementById('perfil').value;
        const divDetalhe = document.getElementById('detalhePerfil');
        const selectDetalhe = document.getElementById('valorDetalhe');
        const labelDetalhe = document.getElementById('labelDetalhe');
        const camposComuns = document.getElementById('camposComuns');
        const grupoAjuda = document.getElementById('grupoAjuda');
        const grupoHoras = document.getElementById('grupoHoras');

        if (!perfil) {
            divDetalhe.style.display = 'none';
            camposComuns.style.display = 'none';
            return;
        }

        divDetalhe.style.display = 'block';
        camposComuns.style.display = 'block';
        selectDetalhe.innerHTML = "";
        selectDetalhe.add(new Option("--", ""));

        if (perfil === 'Esposo' || perfil === 'Familiar') {
            grupoAjuda.style.display = 'none';
            grupoHoras.style.display = 'none';
        } else {
            grupoAjuda.style.display = 'block';
            grupoHoras.style.display = 'block';
        }

        if (perfil === 'Esposa') {
            labelDetalhe.innerText = "Tipo de Jornada:";
            ["Trabalha fora e no lar", "Somente no lar"].forEach(o => selectDetalhe.add(new Option(o, o)));
        } else if (perfil === 'Autonoma') {
            labelDetalhe.innerText = "Tipo de Jornada:";
            selectDetalhe.add(new Option("Gest√£o exclusiva e aut√¥noma do lar", "Gest√£o Aut√¥noma"));
        } else if (perfil === 'Esposo') {
            labelDetalhe.innerText = "Papel:";
            selectDetalhe.add(new Option("C√¥njuge", "C√¥njuge"));
        } else {
            labelDetalhe.innerText = "Grau:";
            selectDetalhe.add(new Option("Familiar Pr√≥ximo", "Familiar"));
        }
    }

    function toggleRelatorio() {
        const pass = prompt("!");
        const area = document.getElementById('areaResultados');
        if (pass === SENHA_MESTRA) {
            area.style.display = area.style.display === 'none' ? 'block' : 'none';
            if(area.style.display === 'block') setTimeout(atualizarInterface, 100);
        } else if (pass !== null) alert("C√≥digo incorreto.");
    }

    // --- CORRE√á√ÉO: GRAVA√á√ÉO NO BANCO DE DADOS GLOBAL ---
    function salvarPesquisa() {
        const perfilSelect = document.getElementById('perfil');
        if (!perfilSelect.value) return alert("Selecione o perfil.");

        let registro = {
            perfil: perfilSelect.value,
            detalhe: document.getElementById('valorDetalhe').value,
            recebeuAjuda: document.getElementById('recebeuAjuda').value,
            contribuiu: document.getElementById('contribuiTarefa').value,
            horas: document.getElementById('horasGeral').value,
            data: new Date().toISOString().split('T')[0]
        };

        // Envia para o Firebase
        database.ref('pesquisas').push(registro)
            .then(() => {
                alert("Dados salvos no banco global!");
                perfilSelect.value = "";
                document.getElementById('recebeuAjuda').value = "";
                document.getElementById('contribuiTarefa').value = "";
                document.getElementById('horasGeral').value = "";
                toggleFields();
            })
            .catch((error) => alert("Erro ao salvar: " + error.message));
    }

    function atualizarInterface() {
        const corpo = document.getElementById('corpoTabela');
        if (!corpo) return;
        corpo.innerHTML = "";
        
        const filtro = document.getElementById('filtroAtividade').value;
        const filtroData = document.getElementById('filtroData').value;
        
        const dataFormatada = filtroData.split('-').reverse().join('/');
        document.getElementById('tituloData').innerText = `Participa√ß√£o em: ${dataFormatada}`;

        const dadosNaData = db.filter(i => i.data === filtroData);
        document.getElementById('totalDataCount').innerText = dadosNaData.length;

        document.getElementById('dataM').innerText = dadosNaData.filter(i => i.perfil === 'Esposa').length;
        document.getElementById('dataA').innerText = dadosNaData.filter(i => i.perfil === 'Autonoma').length;
        document.getElementById('dataH').innerText = dadosNaData.filter(i => i.perfil === 'Esposo').length;
        document.getElementById('dataF').innerText = dadosNaData.filter(i => i.perfil === 'Familiar').length;
        
        const dadosFiltrados = filtro === "Todos" ? db : db.filter(i => i.detalhe === filtro);

        const categorias = [
            { label: "Esposa", key: 'Esposa' },
            { label: "Aut√¥noma", key: 'Autonoma' },
            { label: "Esposo", key: 'Esposo' },

            { label: "Familiares", key: 'Familiar' }
        ];

        let totaisGerais = { Esposa: 0, Autonoma: 0, Esposo: 0, Familiar: 0 };
        let dadosPerfis = [];

        categorias.forEach(cat => {
            const itens = dadosFiltrados.filter(i => i.perfil === cat.key);
            const count = itens.length;
            totaisGerais[cat.key] = count;
            dadosPerfis.push(count);

            corpo.innerHTML += `
                <tr>
                    <td style="text-align:left; font-weight:bold;">${cat.label}</td>
                    <td>${itens.filter(i => i.recebeuAjuda === 'Sim').length}</td>
                    <td>${itens.filter(i => i.contribuiu === 'Sim').length}</td>
                    <td>${itens.filter(i => i.horas === 'At√© 8h').length}</td>
                    <td>${itens.filter(i => i.horas === '8h at√© 14h').length}</td>
                    <td>${itens.filter(i => i.horas === 'Mais de 14h').length}</td>
                    <td style="background:#eee; font-weight:bold;">${count}</td>
                </tr>`;
        });

        document.getElementById('totalM').innerText = totaisGerais.Esposa;
        document.getElementById('totalA').innerText = totaisGerais.Autonoma;
        document.getElementById('totalH').innerText = totaisGerais.Esposo;
        document.getElementById('totalF').innerText = totaisGerais.Familiar;

        gerarGraficos(categorias.map(c => c.label), dadosPerfis, dadosFiltrados);
    }

    function criarOuAtualizarGrafico(id, type, label, labels, data, colors) {
        if (charts[id]) charts[id].destroy();
        
        const dataValuePlugin = {
            id: 'dataValuePlugin',
            afterDatasetsDraw(chart) {
                const { ctx } = chart;
                ctx.save();
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                chart.data.datasets.forEach((dataset, i) => {
                    const total = dataset.data.reduce((acc, val) => acc + val, 0);
                    chart.getDatasetMeta(i).data.forEach((element, index) => {
                        const value = dataset.data[index];
                        if (value === 0) return;
                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) + '%' : '';
                        const text = `${value} (${percentage})`;
                        let x, y;
                        if (type === 'bar') {
                            ctx.fillStyle = '#333';
                            x = element.x;
                            y = element.y - 15;
                        } else {
                            const { x: centerX, y: centerY } = element.tooltipPosition();
                            ctx.fillStyle = '#fff';
                            x = centerX;
                            y = centerY;
                        }
                        ctx.fillText(text, x, y);
                    });
                });
                ctx.restore();
            }
        };

        charts[id] = new Chart(document.getElementById(id).getContext('2d'), {
            type: type,
            data: {
                labels: labels,
                datasets: [{ 
                    label: label, 
                    data: data, 
                    backgroundColor: colors,
                    borderWidth: 1,
                    borderColor: '#fff'
                }]
            },
            plugins: [dataValuePlugin],
            options: { 
                responsive: true, 

                maintainAspectRatio: false, 

                animation: { duration: 0 },
                plugins: {
                    title: {
                        display: true,
                        text: label,
                        font: { size: 18, weight: 'bold' },
                        padding: { top: 10, bottom: 30 }
                    },
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: { font: { size: 14 } }
                    },
                    tooltip: { enabled: true }
                },
                scales: type === 'bar' ? {
                    y: { beginAtZero: true, grace: '15%', ticks: { precision: 0 } }
                } : {}
            }
        });
    }

    function gerarGraficos(labelsPerfis, dadosPerfis, dataSet) {
        const cores = ['#3498db', '#2ecc71', '#e67e22', '#9b59b6', '#f1c40f', '#e74c3c'];

        criarOuAtualizarGrafico('barChart', 'bar', 'Total por Perfil', labelsPerfis, dadosPerfis, cores);
        criarOuAtualizarGrafico('pieChart', 'pie', 'Distribui√ß√£o de Perfis', labelsPerfis, dadosPerfis, cores);

        const h8 = dataSet.filter(i => i.horas === 'At√© 8h').length;
        const h14 = dataSet.filter(i => i.horas === '8h at√© 14h').length;
        const hPlus = dataSet.filter(i => i.horas === 'Mais de 14h').length;
        criarOuAtualizarGrafico('hoursChart', 'bar', 'Carga Hor√°ria Total (Mulheres)', ['At√© 8h', '8h-14h', '+14h'], [h8, h14, hPlus], ['#1abc9c', '#f39c12', '#c0392b']);

        const mulheres = dataSet.filter(i => i.perfil === 'Esposa' || i.perfil === 'Autonoma');
        const mSim = mulheres.filter(i => i.contribuiu === 'Sim').length;
        const mNao = mulheres.filter(i => i.contribuiu === 'N√£o').length;
        criarOuAtualizarGrafico('womenContribChart', 'pie', 'Contribui√ß√£o Feminina', ['Contribui', 'N√£o Contribui'], [mSim, mNao], ['#e91e63', '#f8bbd0']);

        const homens = dataSet.filter(i => i.perfil === 'Esposo');
        const hSim = homens.filter(i => i.contribuiu === 'Sim').length;
        const hNao = homens.filter(i => i.contribuiu === 'N√£o').length;
        criarOuAtualizarGrafico('menContribChart', 'pie', 'Contribui√ß√£o Masculina', ['Contribui', 'N√£o Contribui'], [hSim, hNao], ['#2980b9', '#bdc3c7']);

        const fams = dataSet.filter(i => i.perfil === 'Familiar');
        const fSim = fams.filter(i => i.contribuiu === 'Sim').length;
        const fNao = fams.filter(i => i.contribuiu === 'N√£o').length;
        criarOuAtualizarGrafico('famContribChart', 'pie', 'Contribui√ß√£o Familiar', ['Contribui', 'N√£o Contribui'], [fSim, fNao], ['#8e44ad', '#ecf0f1']);
    }

    // --- CORRE√á√ÉO: LIMPEZA NO BANCO GLOBAL ---
    function limparDados() {
        if (prompt("?") === SENHA_MESTRA && confirm("Apagar hist√≥rico global?")) {
            database.ref('pesquisas').remove()
                .then(() => alert("Banco de dados resetado."))
                .catch((e) => alert("Erro ao limpar: " + e.message));
        }
    }
</script>
</body>
</html>
